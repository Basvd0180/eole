"use strict";(self.webpackChunkdocusaurus_tsx=self.webpackChunkdocusaurus_tsx||[]).push([[4443],{3738:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var o=t(4848),r=t(8453);const s={},a="How do I train the Transformer model?",i={id:"FAQ/transformer",title:"How do I train the Transformer model?",description:"The transformer model is very sensitive to hyperparameters. To run it",source:"@site/docs/FAQ/transformer.md",sourceDirName:"FAQ",slug:"/FAQ/transformer",permalink:"/eole/docs/FAQ/transformer",draft:!1,unlisted:!1,editUrl:"https://github.com/eole-nlp/eole/tree/main/docs/docs/FAQ/transformer.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How can I apply on-the-fly tokenization and subword regularization when training?",permalink:"/eole/docs/FAQ/tokenization"},next:{title:"How can I update a checkpoint's vocabulary?",permalink:"/eole/docs/FAQ/update_vocab"}},c={},d=[];function l(e){const n={a:"a",code:"code",h1:"h1",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"how-do-i-train-the-transformer-model",children:"How do I train the Transformer model?"}),"\n",(0,o.jsxs)(n.p,{children:["The transformer model is very sensitive to hyperparameters. To run it\neffectively you need to set different options that mimic the ",(0,o.jsx)(n.a,{href:"https://arxiv.org/abs/1706.03762",children:"Google"})," setup. We have confirmed the following configuration can replicate their WMT results."]}),"\n",(0,o.jsx)(n.p,{children:"Please have a look at the Example of WMT17 EN-DE."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'<data configuration>\n...\n\n# General opts\nsave_model: mybasemodel\nsave_checkpoint_steps: 10000\nvalid_steps: 10000\ntrain_steps: 200000\n\n# Batching\nbucket_size: 262144\nworld_size: 4\ngpu_ranks: [0, 1, 2, 3]\nnum_workers: 2\nbatch_type: "tokens"\nbatch_size: 4096\nvalid_batch_size: 2048\naccum_count: [4]\naccum_steps: [0]\n\n# Optimization\nmodel_dtype: "fp16"\noptim: "adam"\nlearning_rate: 2\nwarmup_steps: 8000\ndecay_method: "noam"\nadam_beta2: 0.998\nmax_grad_norm: 0\nlabel_smoothing: 0.1\nparam_init: 0\nparam_init_glorot: true\nnormalization: "tokens"\n\n# Model\nencoder_type: transformer\ndecoder_type: transformer\nposition_encoding: true\nenc_layers: 6\ndec_layers: 6\nheads: 8\nhidden_size: 512\nword_vec_size: 512\ntransformer_ff: 2048\ndropout_steps: [0]\ndropout: [0.1]\nattention_dropout: [0.1]\n'})}),"\n",(0,o.jsx)(n.p,{children:"Here are what the most important parameters mean:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"param_init_glorot"})," & ",(0,o.jsx)(n.code,{children:"param_init 0"}),": correct initialization of parameters;"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"position_encoding"}),": add sinusoidal position encoding to each embedding;"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"optim adam"}),", ",(0,o.jsx)(n.code,{children:"decay_method noam"}),", ",(0,o.jsx)(n.code,{children:"warmup_steps 8000"}),": use special learning rate;"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"batch_type tokens"}),", ",(0,o.jsx)(n.code,{children:"normalization tokens"}),": batch and normalize based on number of tokens and not sentences;"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"accum_count 4"}),": compute gradients based on four batches;"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"label_smoothing 0.1"}),": use label smoothing loss."]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var o=t(6540);const r={},s=o.createContext(r);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);